/*
  struct.js ver0.2

  This module use Proxy API provided by ECMAScript 6 (Harmony)
  @see http://wiki.ecmascript.org/doku.php?id=harmony:direct_proxies

  With ES6-shim(https://github.com/paulmillr/es6-shim) it
  could also work in Firefox4 or Chrome.

  @author hagino3000(http://twitter.com/hagino3000)

 *
 */(function(a){function g(a,c){return c=c||{},Object.defineProperty(c,b,{value:a,wriatble:!1,enumerable:!1}),c}function h(a,b){var d=a.match(c);return d&&f.isStruct(b)?f.getType(b)===d[1]:!1}function i(a,b){return e[a]?e[a](b):!1}function j(a,b){for(var d in b)if(b.hasOwnProperty(d)){var e=b[d],g=a[d];if(y(g)){if(e.nullable===!1)throw d+" is not-nullable property but initial value is null";continue}if(h(e.type,g)||i(e.type,g))continue;var k=e.type.match(c);if(k){var l=k[1];j(g,f.structs[l]),a[d]=f.create(l,g);continue}throw d+" must be "+b[d].type+" type. But initial value not matched"}}function k(a,b){return{getOwnPropertyDescriptor:function(b){var c=Object.getOwnPropertyDescriptor(a,b);return c!==undefined&&(c.configurable=!0),c},getPropertyDescriptor:function(b){var c=Object.getPropertyDescriptor(a,b);return c!==undefined&&(c.configurable=!0),c},getOwnPropertyNames:function(){return Object.getOwnPropertyNames(a)},getPropertyNames:function(){return Object.getPropertyNames(a)},defineProperty:function(a,b){throw"Cannot fix this object"},"delete":function(c){if(c in b){var d=this.getOwnPropertyDescriptor(c);if(b[c].nullable===!1)throw c+" is not allowd null or undefined";return delete a[c]}throw c+" is not defined in this struct"},fix:function(){return Object.isFrozen(a)?Object.getOwnPropertyNames(a).map(function(b){return Object.getOwnPropertyDescriptor(a,b)}):undefined},has:function(b){return b in a},hasOwn:function(b){return Object.prototype.hasOwnProperty.call(a,b)},get:function(c,d){if(d in b)return a[d];throw d+" is not defined in this struct"},set:function(c,d,e){if(d in b){var f=this.getOwnPropertyDescriptor(d);if(f&&!f.writable)throw d+" is not writable property";if(b[d].nullable===!1&&y(e))throw d+" is not allowd null or undefined";var g=b[d].type;if(!(y(e)||h(g,e)||i(g,e)))throw d+" must be "+b[d].type+" type";return a[d]=e,!0}throw d+" is not defined in this struct"},enumerate:function(){var b=[];for(var c in a)b.push(c);return b},keys:function(){return Object.keys(a)}}}function l(){return{string:n,number:o,"boolean":p,"function":q,array:r,arraylike:s,object:t,anyobject:u,regexp:v,date:w,domnode:x}}function m(a){return Object.prototype.toString.call(a)}function n(a){return m(a)==="[object String]"}function o(a){return m(a)==="[object Number]"&&!isNaN(a)}function p(a){return m(a)==="[object Boolean]"}function q(a){return m(a)==="[object Function]"}function r(a){return m(a)==="[object Array]"}function s(a){return r(a)||a&&typeof a=="object"&&o(a.length)}function t(a){return m(a)==="[object Object]"}function u(a){return a!==null&&typeof a=="object"}function v(a){return m(a)==="[object RegExp]"}function w(a){return m(a)==="[object Date]"}function x(a){return a&&n(a.nodeName)&&s(a.childNodes)}function y(a){return a===null||a===undefined}"use strict";if(typeof a.Struct!="undefined")return;var b="__structName__",c=/^struct:(.+)/,d=window.Proxy&&q(Proxy.create),e=l(),f=a.Struct={structs:{}};f.define=function(a,c){if(!n(a))throw"First argument must be String type (Struct name)";if(!t(c))throw"Second argument must be Object type (Property settings)";if(this.structs[a])throw a+" is already defined";Object.keys(c).forEach(function(a){c[a].writable===undefined&&(c[a].writable=!0)}),c[b]={value:a,wriatble:!1,enumerable:!1},Object.freeze(c),this.structs[a]=c},f.ifdef=function(a){return!!this.structs.hasOwnProperty(a)},f.getType=function(a){if(!u(a))throw"First argument must be object type";return t(a)&&a.hasOwnProperty(b)?a[b]:undefined},f.isStruct=function(a){return t(a)&&n(a[b])},f.create=function(a,b){if(!this.structs.hasOwnProperty(a))throw'Struct named "'+a+'" is not defined';var c=this.structs[a];b=b||{},j(b,c),Object.defineProperties(b,c);var e;return d?e=Proxy.create(k(b,c)):e=Object.seal(b),e},f.configure=function(a){Object.keys(this.structs).length>0&&console.log("WARNING: Some structs are already defined.This configure does not applied them."),a["disable any check"]===!0&&(f.create=g)}})(this);