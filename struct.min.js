/*
  struct.js ver0.1

  This module use Proxy API provided by ECMAScript 6 (Harmony)
  @see http://wiki.ecmascript.org/doku.php?id=harmony:direct_proxies

  With ES6-shim(https://github.com/paulmillr/es6-shim) it
  could also work in Firefox4 or Chrome.

  @author hagino3000(http://twitter.com/hagino3000)

 *
 */(function(a){function g(a,b){var d=a.match(c);return d&&f.isStruct(b)?(console.log(d[1]),console.log(f.getType(b)),f.getType(b)===d[1]):!1}function h(a,b){return e[a]?e[a](b):!1}function i(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],e=a[c];if(d.nullable===!1&&x(e))throw c+" is not-nullable property but initial value is null";if(!(x(e)||g(d.type,e)||h(d.type,e)))throw c+" must be "+b[c].type+" type. But initial value not matched"}}function j(a,b){return{getOwnPropertyDescriptor:function(b){var c=Object.getOwnPropertyDescriptor(a,b);return c!==undefined&&(c.configurable=!0),c},getPropertyDescriptor:function(b){var c=Object.getPropertyDescriptor(a,b);return c!==undefined&&(c.configurable=!0),c},getOwnPropertyNames:function(){return Object.getOwnPropertyNames(a)},getPropertyNames:function(){return Object.getPropertyNames(a)},defineProperty:function(a,b){throw"Cannot fix this object"},"delete":function(c){if(c in b){var d=this.getOwnPropertyDescriptor(c);if(b[c].nullable===!1)throw c+" is not allowd null or undefined";return delete a[c]}throw c+" is not defined in this struct"},fix:function(){return Object.isFrozen(a)?Object.getOwnPropertyNames(a).map(function(b){return Object.getOwnPropertyDescriptor(a,b)}):undefined},has:function(b){return b in a},hasOwn:function(b){return Object.prototype.hasOwnProperty.call(a,b)},get:function(c,d){if(d in b)return a[d];throw d+" is not defined in this struct"},set:function(c,d,e){if(d in b){var f=this.getOwnPropertyDescriptor(d);if(f&&!f.writable)throw d+" is not writable property";if(b[d].nullable===!1&&x(e))throw d+" is not allowd null or undefined";var i=b[d].type;if(!(x(e)||g(i,e)||h(i,e)))throw d+" must be "+b[d].type+" type";return a[d]=e,!0}throw d+" is not defined in this struct"},enumerate:function(){var b=[];for(var c in a)b.push(c);return b},keys:function(){return Object.keys(a)}}}function k(){return{string:m,number:n,"boolean":o,"function":p,array:q,arraylike:r,object:s,anyobject:t,regexp:u,date:v,domnode:w}}function l(a){return Object.prototype.toString.call(a)}function m(a){return l(a)==="[object String]"}function n(a){return l(a)==="[object Number]"&&!isNaN(a)}function o(a){return l(a)==="[object Boolean]"}function p(a){return l(a)==="[object Function]"}function q(a){return l(a)==="[object Array]"}function r(a){return q(a)||a&&typeof a=="object"&&n(a.length)}function s(a){return l(a)==="[object Object]"}function t(a){return a!==null&&typeof a=="object"}function u(a){return l(a)==="[object RegExp]"}function v(a){return l(a)==="[object Date]"}function w(a){return a&&m(a.nodeName)&&r(a.childNodes)}function x(a){return a===null||a===undefined}"use strict";if(typeof f!="undefined")return;var b="__structName__",c=/^struct:(.+)/,d=window.Proxy&&p(Proxy.create),e=k(),f=a.Struct={structs:{}};f.define=function(a,c){if(!m(a))throw"First argument must be String type (Struct name)";if(!s(c))throw"Second argument must be Object type (Property settings)";if(this.structs[a])throw a+" is already defined";Object.keys(c).forEach(function(a){c[a].writable===undefined&&(c[a].writable=!0)}),c[b]={value:a,wriatble:!1,enumerable:!1},Object.freeze(c),this.structs[a]=c},f.getType=function(a){if(!t(a))throw"First argument must be object type";return s(a)&&a.hasOwnProperty(b)?a[b]:undefined},f.isStruct=function(a){return s(a)&&m(a[b])},f.create=function(a,b){if(!this.structs.hasOwnProperty(a))throw'Struct named "'+a+'" is not defined';var c=this.structs[a];b=b||{},i(b,c),Object.defineProperties(b,c);var e;return d?e=Proxy.create(j(b,c)):e=Object.seal(b),e}})(this);